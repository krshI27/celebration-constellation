stages:
  - lint

black-check:
  stage: lint
  image: mambaorg/micromamba:1.5.7
  variables:
    MAMBA_ROOT_PREFIX: /opt/conda
  cache:
    key: micromamba-conda-forge
    paths:
      - /opt/conda/pkgs
  before_script:
    # Create a lightweight env with Black from conda-forge
    - micromamba --version
    - micromamba create -y -n ci -c conda-forge black
  script:
    - micromamba run -n ci black --version
    - micromamba run -n ci black --check --diff src/ tests/ streamlit_app.py
  # By default, this runs on any push and MR. To limit to MR only,
  # replace rules with the single merge_request_event rule below.
  rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
      when: always
    - if: $CI_COMMIT_BRANCH
      when: on_success
